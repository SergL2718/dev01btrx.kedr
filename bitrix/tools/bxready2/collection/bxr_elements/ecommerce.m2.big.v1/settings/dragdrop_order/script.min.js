function initDraggableOrderControl(b){var a=JSON.parse(b.data);if(a){BX.loadScript("/bitrix/js/main/core/core_dragdrop.js",function(){(function c(){if(!!BX.DragDrop){window["dnd_parameter_"+b.propertyID]=new DragNDropOrderParameterControl(a,b)}else{setTimeout(c,50)}})()})}}function DragNDropOrderParameterControl(a,c){var b=BX.util.getRandomString(5);this.params=c||{};this.items=this.getSortedItems(a);this.rootElementId="dnd_params_container_"+this.params.propertyID+"_"+b;this.dragItemClassName="dnd-order-draggable-item-"+this.params.propertyID+"-"+b;BX.loadCSS(this.getPath()+"/style.css?"+b);this.buildNodes();this.initDragDrop()}DragNDropOrderParameterControl.prototype={getPath:function(){var a=this.params.propertyParams.JS_FILE.split("/");a.pop();return a.join("/")},getSortedItems:function(e){if(!e){return[]}var b=this.params.oInput.value||this.params.propertyParams.DEFAULT||"",a=[],d;var c=b.split(",");for(d in c){if(c.hasOwnProperty(d)){c[d]=BX.util.trim(c[d]);if(e[c[d]]){a.push({value:c[d],message:e[c[d]]})}}}for(d in e){if(e.hasOwnProperty(d)&&!BX.util.in_array(d,c)){a.push({value:d,message:e[d]})}}return a},buildNodes:function(){var b=BX.create("DIV",{props:{className:"dnd-order-draggable-control-container",id:this.rootElementId}});for(var a in this.items){if(this.items.hasOwnProperty(a)){b.appendChild(BX.create("DIV",{attrs:{"data-value":this.items[a].value},props:{className:"dnd-order-draggable-control dnd-order-draggable-item "+this.dragItemClassName},text:this.items[a].message}))}}this.params.oCont.appendChild(b)},initDragDrop:function(){if(BX.isNodeInDom(this.params.oCont)){this.dragdrop=BX.DragDrop.create({dragItemClassName:this.dragItemClassName,dragItemControlClassName:"dnd-order-draggable-control",sortable:{rootElem:BX(this.rootElementId)},dragEnd:BX.delegate(function(c,a,b){this.saveData()},this)})}else{setTimeout(BX.delegate(this.initDragDrop,this),50)}},saveData:function(){var c=this.params.oCont.querySelectorAll("."+this.dragItemClassName),a=[];for(var b in c){if(c.hasOwnProperty(b)){a.push(c[b].getAttribute("data-value"))}}this.params.oInput.value=a.join(",")}};