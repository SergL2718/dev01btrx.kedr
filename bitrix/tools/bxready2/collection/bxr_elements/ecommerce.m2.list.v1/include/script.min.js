if(window){window.JCCatalogSection=function(a){this.productType=0;this.showQuantity=true;this.showAbsent=true;this.secondPict=false;this.showOldPrice=false;this.showPercent=false;this.showSkuProps=false;this.basketAction="ADD";this.showClosePopup=false;this.useCompare=false;this.visual={ID:"",PICT_ID:"",SECOND_PICT_ID:"",QUANTITY_ID:"",QUANTITY_UP_ID:"",QUANTITY_DOWN_ID:"",PRICE_ID:"",DSC_PERC:"",SECOND_DSC_PERC:"",DISPLAY_PROP_DIV:"",BASKET_PROP_DIV:""};this.product={checkQuantity:false,maxQuantity:0,stepQuantity:1,isDblQuantity:false,canBuy:true,canSubscription:true,name:"",pict:{},id:0,addUrl:"",buyUrl:""};this.basketMode="";this.basketData={useProps:false,emptyProps:false,quantity:"quantity",props:"prop",basketUrl:"",sku_props:"",sku_props_var:"basket_props",add_url:"",buy_url:""};this.compareData={compareUrl:"",comparePath:""};this.defaultPict={pict:null,secondPict:null};this.checkQuantity=false;this.maxQuantity=0;this.stepQuantity=1;this.isDblQuantity=false;this.canBuy=true;this.currentBasisPrice={};this.canSubscription=true;this.precision=6;this.precisionFactor=Math.pow(10,this.precision);this.offers=[];this.offerNum=0;this.treeProps=[];this.obTreeRows=[];this.showCount=[];this.showStart=[];this.selectedValues={};this.obProduct=null;this.obQuantity=null;this.obQuantityUp=null;this.obQuantityDown=null;this.obPict=null;this.obSecondPict=null;this.obPrice=null;this.obTree=null;this.obBuyBtn=null;this.obBasketActions=null;this.obNotAvail=null;this.obDscPerc=null;this.obSecondDscPerc=null;this.obSkuProps=null;this.obMeasure=null;this.obCompare=null;this.obPopupWin=null;this.basketUrl="";this.basketParams={};this.treeRowShowSize=5;this.treeEnableArrow={display:"",cursor:"pointer",opacity:1};this.treeDisableArrow={display:"",cursor:"default",opacity:0.2};this.lastElement=false;this.containerHeight=0;this.errorCode=0;if("object"===typeof a){this.productType=parseInt(a.PRODUCT_TYPE,10);this.showQuantity=a.SHOW_QUANTITY;this.showAbsent=a.SHOW_ABSENT;this.secondPict=!!a.SECOND_PICT;this.showOldPrice=!!a.SHOW_OLD_PRICE;this.showPercent=!!a.SHOW_DISCOUNT_PERCENT;this.showSkuProps=!!a.SHOW_SKU_PROPS;if(!!a.ADD_TO_BASKET_ACTION){this.basketAction=a.ADD_TO_BASKET_ACTION}this.showClosePopup=!!a.SHOW_CLOSE_POPUP;this.useCompare=!!a.DISPLAY_COMPARE;this.visual=a.VISUAL;switch(this.productType){case 0:case 1:case 2:if(!!a.PRODUCT&&"object"===typeof(a.PRODUCT)){if(this.showQuantity){this.product.checkQuantity=a.PRODUCT.CHECK_QUANTITY;this.product.isDblQuantity=a.PRODUCT.QUANTITY_FLOAT;if(this.product.checkQuantity){this.product.maxQuantity=(this.product.isDblQuantity?parseFloat(a.PRODUCT.MAX_QUANTITY):parseInt(a.PRODUCT.MAX_QUANTITY,10))}this.product.stepQuantity=(this.product.isDblQuantity?parseFloat(a.PRODUCT.STEP_QUANTITY):parseInt(a.PRODUCT.STEP_QUANTITY,10));this.checkQuantity=this.product.checkQuantity;this.isDblQuantity=this.product.isDblQuantity;this.maxQuantity=this.product.maxQuantity;this.stepQuantity=this.product.stepQuantity;if(this.isDblQuantity){this.stepQuantity=Math.round(this.stepQuantity*this.precisionFactor)/this.precisionFactor}}this.product.canBuy=a.PRODUCT.CAN_BUY;this.product.canSubscription=a.PRODUCT.SUBSCRIPTION;if(!!a.PRODUCT.BASIS_PRICE){this.currentBasisPrice=a.PRODUCT.BASIS_PRICE}this.canBuy=this.product.canBuy;this.canSubscription=this.product.canSubscription;this.product.name=a.PRODUCT.NAME;this.product.pict=a.PRODUCT.PICT;this.product.id=a.PRODUCT.ID;if(!!a.PRODUCT.ADD_URL){this.product.addUrl=a.PRODUCT.ADD_URL}if(!!a.PRODUCT.BUY_URL){this.product.buyUrl=a.PRODUCT.BUY_URL}if(!!a.BASKET&&"object"===typeof(a.BASKET)){this.basketData.useProps=!!a.BASKET.ADD_PROPS;this.basketData.emptyProps=!!a.BASKET.EMPTY_PROPS}}else{this.errorCode=-1}break;case 3:if(!!a.OFFERS&&BX.type.isArray(a.OFFERS)){if(!!a.PRODUCT&&"object"===typeof(a.PRODUCT)){this.product.name=a.PRODUCT.NAME;this.product.id=a.PRODUCT.ID}$.each(a.OFFERS,function(b){b=this.ID;if(!BXReady.Market.basketValues[b]){BXReady.Market.basketValues[b]=this.BASKET_VALUES}});this.offers=a.OFFERS;this.offerNum=0;if(!!a.OFFER_SELECTED){this.offerNum=parseInt(a.OFFER_SELECTED,10)}if(isNaN(this.offerNum)){this.offerNum=0}if(!!a.TREE_PROPS){this.treeProps=a.TREE_PROPS}if(!!a.DEFAULT_PICTURE){this.defaultPict.pict=a.DEFAULT_PICTURE.PICTURE;this.defaultPict.secondPict=a.DEFAULT_PICTURE.PICTURE_SECOND}}break;default:this.errorCode=-1}if(!!a.BASKET&&"object"===typeof(a.BASKET)){if(!!a.BASKET.QUANTITY){this.basketData.quantity=a.BASKET.QUANTITY}if(!!a.BASKET.PROPS){this.basketData.props=a.BASKET.PROPS}if(!!a.BASKET.BASKET_URL){this.basketData.basketUrl=a.BASKET.BASKET_URL}if(3===this.productType){if(!!a.BASKET.SKU_PROPS){this.basketData.sku_props=a.BASKET.SKU_PROPS}}if(!!a.BASKET.ADD_URL_TEMPLATE){this.basketData.add_url=a.BASKET.ADD_URL_TEMPLATE}if(!!a.BASKET.BUY_URL_TEMPLATE){this.basketData.buy_url=a.BASKET.BUY_URL_TEMPLATE}}if(this.useCompare){if(!!a.COMPARE&&typeof(a.COMPARE)==="object"){if(!!a.COMPARE.COMPARE_PATH){this.compareData.comparePath=a.COMPARE.COMPARE_PATH}if(!!a.COMPARE.COMPARE_URL_TEMPLATE){this.compareData.compareUrl=a.COMPARE.COMPARE_URL_TEMPLATE}else{this.useCompare=false}}else{this.useCompare=false}}this.lastElement=(!!a.LAST_ELEMENT&&"Y"===a.LAST_ELEMENT)}if(0===this.errorCode){BX.ready(BX.delegate(this.Init,this))}};window.JCCatalogSection.prototype.Init=function(){var a=0,c="",b=null;this.obProduct=BX(this.visual.ID);if(!this.obProduct){this.errorCode=-1}this.obPict=BX(this.visual.PICT_ID);if(!this.obPict){this.errorCode=-2}if(this.secondPict&&!!this.visual.SECOND_PICT_ID){this.obSecondPict=BX(this.visual.SECOND_PICT_ID)}this.obPrice=BX(this.visual.PRICE_ID);if(!this.obPrice){this.errorCode=-16}if(this.showQuantity&&!!this.visual.QUANTITY_ID){this.obQuantity=BX(this.visual.QUANTITY_ID);if(!!this.visual.QUANTITY_UP_ID){this.obQuantityUp=BX(this.visual.QUANTITY_UP_ID)}if(!!this.visual.QUANTITY_DOWN_ID){this.obQuantityDown=BX(this.visual.QUANTITY_DOWN_ID)}}if(3===this.productType&&this.offers.length>0){if(!!this.visual.TREE_ID){this.obTree=BX(this.visual.TREE_ID);if(!this.obTree){this.errorCode=-256}c=this.visual.TREE_ITEM_ID;for(a=0;a<this.treeProps.length;a++){this.obTreeRows[a]={LEFT:BX(c+this.treeProps[a].ID+"_left"),RIGHT:BX(c+this.treeProps[a].ID+"_right"),LIST:BX(c+this.treeProps[a].ID+"_list"),CONT:BX(c+this.treeProps[a].ID+"_cont")};if(!this.obTreeRows[a].LEFT||!this.obTreeRows[a].RIGHT||!this.obTreeRows[a].LIST||!this.obTreeRows[a].CONT){this.errorCode=-512;break}}}if(!!this.visual.QUANTITY_MEASURE){this.obMeasure=BX(this.visual.QUANTITY_MEASURE)}}this.obBasketActions=BX(this.visual.BASKET_ACTIONS_ID);if(!!this.obBasketActions){if(!!this.visual.BUY_ID){this.obBuyBtn=BX(this.visual.BUY_ID)}}this.obNotAvail=BX(this.visual.NOT_AVAILABLE_MESS);if(this.showPercent){if(!!this.visual.DSC_PERC){this.obDscPerc=BX(this.visual.DSC_PERC)}if(this.secondPict&&!!this.visual.SECOND_DSC_PERC){this.obSecondDscPerc=BX(this.visual.SECOND_DSC_PERC)}}if(this.showSkuProps){if(!!this.visual.DISPLAY_PROP_DIV){this.obSkuProps=BX(this.visual.DISPLAY_PROP_DIV)}}if(0===this.errorCode){if(this.showQuantity){if(!!this.obQuantityUp){BX.bind(this.obQuantityUp,"click",BX.delegate(this.QuantityUp,this))}if(!!this.obQuantityDown){BX.bind(this.obQuantityDown,"click",BX.delegate(this.QuantityDown,this))}if(!!this.obQuantity){BX.bind(this.obQuantity,"change",BX.delegate(this.QuantityChange,this))}}switch(this.productType){case 1:break;case 3:if(this.offers.length>0){b=BX.findChildren(this.obTree,{tagName:"li"},true);if(!!b&&0<b.length){for(a=0;a<b.length;a++){BX.bind(b[a],"click",BX.delegate(this.SelectOfferProp,this))}}for(a=0;a<this.obTreeRows.length;a++){BX.bind(this.obTreeRows[a].LEFT,"click",BX.delegate(this.RowLeft,this));BX.bind(this.obTreeRows[a].RIGHT,"click",BX.delegate(this.RowRight,this))}this.SetCurrent()}break}if(!!this.obBuyBtn){if(this.basketAction==="ADD"){BX.bind(this.obBuyBtn,"click",BX.delegate(this.Add2Basket,this))}else{BX.bind(this.obBuyBtn,"click",BX.delegate(this.BuyBasket,this))}}if(this.lastElement){this.containerHeight=parseInt(this.obProduct.parentNode.offsetHeight,10);if(isNaN(this.containerHeight)){this.containerHeight=0}}if(this.useCompare){this.obCompare=BX(this.visual.COMPARE_LINK_ID);if(!!this.obCompare){BX.bind(this.obCompare,"click",BX.proxy(this.Compare,this))}}}};window.JCCatalogSection.prototype.SelectOfferProp=function(){var a=0,c="",b="",e=[],f=null,d=BX.proxy_context;if(!!d&&d.hasAttribute("data-treevalue")){b=d.getAttribute("data-treevalue");e=b.split("_");if(this.SearchOfferPropIndex(e[0],e[1])){f=BX.findChildren(d.parentNode,{tagName:"li"},false);if(!!f&&0<f.length){for(a=0;a<f.length;a++){c=f[a].getAttribute("data-onevalue");if(c===e[1]){BX.addClass(f[a],"bx_active")}else{BX.removeClass(f[a],"bx_active")}}}}}};window.JCCatalogSection.prototype.SearchOfferPropIndex=function(c,l){var g="",m=false,d,b,h=[],a=[],e=-1,f={},k=[];for(d=0;d<this.treeProps.length;d++){if(this.treeProps[d].ID===c){e=d;break}}if(-1<e){for(d=0;d<e;d++){g="PROP_"+this.treeProps[d].ID;f[g]=this.selectedValues[g]}g="PROP_"+this.treeProps[e].ID;m=this.GetRowValues(f,g);if(!m){return false}if(!BX.util.in_array(l,m)){return false}f[g]=l;for(d=e+1;d<this.treeProps.length;d++){g="PROP_"+this.treeProps[d].ID;m=this.GetRowValues(f,g);if(!m){return false}a=[];if(this.showAbsent){h=[];k=[];k=BX.clone(f,true);for(b=0;b<m.length;b++){k[g]=m[b];a[a.length]=m[b];if(this.GetCanBuy(k)){h[h.length]=m[b]}}}else{h=m}if(!!this.selectedValues[g]&&BX.util.in_array(this.selectedValues[g],h)){f[g]=this.selectedValues[g]}else{if(this.showAbsent){f[g]=(h.length>0?h[0]:a[0])}else{f[g]=h[0]}}this.UpdateRow(d,f[g],m,h)}this.selectedValues=f;this.ChangeInfo()}return true};window.JCCatalogSection.prototype.RowLeft=function(){var b=0,c="",a=-1,d=BX.proxy_context;if(!!d&&d.hasAttribute("data-treevalue")){c=d.getAttribute("data-treevalue");for(b=0;b<this.treeProps.length;b++){if(this.treeProps[b].ID===c){a=b;break}}if(-1<a&&this.treeRowShowSize<this.showCount[a]){if(0>this.showStart[a]){this.showStart[a]++;BX.adjust(this.obTreeRows[a].LIST,{style:{marginLeft:this.showStart[a]*20+"%"}});BX.adjust(this.obTreeRows[a].RIGHT,{style:this.treeEnableArrow})}if(0<=this.showStart[a]){BX.adjust(this.obTreeRows[a].LEFT,{style:this.treeDisableArrow})}}}};window.JCCatalogSection.prototype.RowRight=function(){var b=0,c="",a=-1,d=BX.proxy_context;if(!!d&&d.hasAttribute("data-treevalue")){c=d.getAttribute("data-treevalue");for(b=0;b<this.treeProps.length;b++){if(this.treeProps[b].ID===c){a=b;break}}if(-1<a&&this.treeRowShowSize<this.showCount[a]){if((this.treeRowShowSize-this.showStart[a])<this.showCount[a]){this.showStart[a]--;BX.adjust(this.obTreeRows[a].LIST,{style:{marginLeft:this.showStart[a]*20+"%"}});BX.adjust(this.obTreeRows[a].LEFT,{style:this.treeEnableArrow})}if((this.treeRowShowSize-this.showStart[a])>=this.showCount[a]){BX.adjust(this.obTreeRows[a].RIGHT,{style:this.treeDisableArrow})}}}};window.JCCatalogSection.prototype.UpdateRow=function(g,f,a,n){var p=0,q=0,m="",b=0,s="",d={},j=false,e=false,l=false,k=0,h=this.treeEnableArrow,r=this.treeEnableArrow,c=0,o=null;if(-1<g&&g<this.obTreeRows.length){o=BX.findChildren(this.obTreeRows[g].LIST,{tagName:"li"},false);if(!!o&&0<o.length){j=("PICT"===this.treeProps[g].SHOW_MODE);b=a.length;e=this.treeRowShowSize<b;s=(e?(100/b)+"%":"20%");d={props:{className:""},style:{}};if(j){d.style.paddingTop=s}for(p=0;p<o.length;p++){m=o[p].getAttribute("data-onevalue");l=(m===f);d.props.className=(l?"bx_active":"");d.style.display="none";if(BX.util.in_array(m,a)){d.style.display="";if(l){k=q}q++}BX.adjust(o[p],d)}d={style:{marginLeft:"0%"}};if(j){BX.adjust(this.obTreeRows[g].CONT,{props:{className:(e?"bx_item_detail_scu full":"bx_item_detail_scu")}})}else{BX.adjust(this.obTreeRows[g].CONT,{props:{className:(e?"bx_item_detail_size full":"bx_item_detail_size")}})}if(e){if(k+1===b){r=this.treeDisableArrow}if(this.treeRowShowSize<=k){c=this.treeRowShowSize-k-1;d.style.marginLeft=c*20+"%"}if(0===c){h=this.treeDisableArrow}BX.adjust(this.obTreeRows[g].LEFT,{style:h});BX.adjust(this.obTreeRows[g].RIGHT,{style:r})}else{BX.adjust(this.obTreeRows[g].LEFT,{style:{display:"none"}});BX.adjust(this.obTreeRows[g].RIGHT,{style:{display:"none"}})}BX.adjust(this.obTreeRows[g].LIST,d);this.showCount[g]=b;this.showStart[g]=c}}};window.JCCatalogSection.prototype.GetRowValues=function(b,d){var e=0,c,a=[],f=false,g=true;if(0===b.length){for(e=0;e<this.offers.length;e++){if(!BX.util.in_array(this.offers[e].TREE[d],a)){a[a.length]=this.offers[e].TREE[d]}}f=true}else{for(e=0;e<this.offers.length;e++){g=true;for(c in b){if(b[c]!==this.offers[e].TREE[c]){g=false;break}}if(g){if(!BX.util.in_array(this.offers[e].TREE[d],a)){a[a.length]=this.offers[e].TREE[d]}f=true}}}return(f?a:false)};window.JCCatalogSection.prototype.GetCanBuy=function(a){var c=0,b,d=false,e=true;for(c=0;c<this.offers.length;c++){e=true;for(b in a){if(a[b]!==this.offers[c].TREE[b]){e=false;break}}if(e){if(this.offers[c].CAN_BUY){d=true;break}}}return d};window.JCCatalogSection.prototype.SetCurrent=function(){var f=0,e=0,a=[],g="",d=false,c={},b=[],h=this.offers[this.offerNum].TREE;for(f=0;f<this.treeProps.length;f++){g="PROP_"+this.treeProps[f].ID;d=this.GetRowValues(c,g);if(!d){break}if(BX.util.in_array(h[g],d)){c[g]=h[g]}else{c[g]=d[0];this.offerNum=0}if(this.showAbsent){a=[];b=[];b=BX.clone(c,true);for(e=0;e<d.length;e++){b[g]=d[e];if(this.GetCanBuy(b)){a[a.length]=d[e]}}}else{a=d}this.UpdateRow(f,c[g],d,a)}this.selectedValues=c;this.ChangeInfo()};window.JCCatalogSection.prototype.ChangeInfo=function(){var c=0,b,a=-1,d=true;for(c=0;c<this.offers.length;c++){d=true;for(b in this.selectedValues){if(this.selectedValues[b]!==this.offers[c].TREE[b]){d=false;break}}if(d){a=c;break}}if(-1<a){if(!!this.obPict){if(!!this.offers[a].PREVIEW_PICTURE){BX.adjust(this.obPict,{props:{src:this.offers[a].PREVIEW_PICTURE.SRC}})}else{BX.adjust(this.obPict,{props:{src:this.defaultPict.pict.SRC}})}}if(this.secondPict&&!!this.obSecondPict){if(!!this.offers[a].PREVIEW_PICTURE_SECOND){BX.adjust(this.obSecondPict,{props:{src:this.offers[a].PREVIEW_PICTURE_SECOND.SRC}})}else{if(!!this.offers[a].PREVIEW_PICTURE.SRC){BX.adjust(this.obSecondPict,{props:{src:this.offers[a].PREVIEW_PICTURE.SRC}})}else{if(!!this.defaultPict.secondPict){BX.adjust(this.obSecondPict,{props:{src:this.defaultPict.secondPict.SRC}})}else{BX.adjust(this.obSecondPict,{props:{src:this.defaultPict.pict.SRC}})}}}}if(this.showSkuProps&&!!this.obSkuProps){if(0===this.offers[a].DISPLAY_PROPERTIES.length){BX.adjust(this.obSkuProps,{style:{display:"none"},html:""})}else{BX.adjust(this.obSkuProps,{style:{display:""},html:this.offers[a].DISPLAY_PROPERTIES})}}$("#"+this.visual.AVAIL_ID+">div").hide();$("#"+this.visual.AVAIL_ID).children("#bxr-offer-avail-"+this.offers[a].ID).show();$("#"+this.visual.PRICE_ID+">div").hide();$("#"+this.visual.PRICE_ID).children("#bxr-offer-price-"+this.offers[a].ID).show();if(this.offers[a].NAME!==""){$("#"+this.visual.NAME).find("a").html(this.offers[a].NAME);$("#"+this.visual.NAME).find("a").attr("title",this.offers[a].NAME)}$("#"+this.visual.ID+" .bxr-counter-item-basket").data("item",this.offers[a].ID);$("#"+this.visual.ID+" .bxr-indicator-item-basket").data("item",this.offers[a].ID);$("#"+this.visual.ID+" .bxr-counter-item-basket").attr("data-item",this.offers[a].ID);$("#"+this.visual.ID+" .bxr-indicator-item-basket").attr("data-item",this.offers[a].ID);basket=window.BXReady.Market.Basket;if(basket!=undefined){if(basket.list.ITEMS!=undefined&&basket.list.ALL!=undefined){$("#"+this.visual.ID+" .bxr-counter-item-basket").html(basket.list.ALL[this.offers[a].ID]);if(basket.list.ALL[this.offers[a].ID]>0){$("#"+this.visual.ID+" .bxr-indicator-item-basket").addClass("bxr-indicator-item-active")}}else{$("#"+this.visual.ID+" .bxr-indicator-item-basket").removeClass("bxr-indicator-item-active")}}if($("#"+this.visual.FAST_VIEW_ID).length>0){$("#"+this.visual.FAST_VIEW_ID).data("offer-id",this.offers[a].ID)}if(useSkuLinks=="Y"){$("#"+this.visual.NAME).find("a").attr("href",this.offers[a].BASKET_VALUES.LINK);$("#"+this.visual.FAST_VIEW_ID).data("element-url",this.offers[a].BASKET_VALUES.LINK);$("#"+this.visual.ID+" .bxr-element-image a").attr("href",this.offers[a].BASKET_VALUES.LINK)}BXReady.Market.setBasketIds(this.offers[a].ID,"","#"+this.visual.BASKET_ACTIONS_ID);this.offerNum=a}}};